<!DOCTYPE html>
<html>

<head>
    <title>podChat</title>
    <link href="http://fams.fanapsoft.com/TSK/favicon.ico" rel="icon" type="image/x-icon"/>
    <!-- Development Mode -->
    <script type="text/javascript" src="../src/utility/utility.js"></script>
    <script type="text/javascript" src="../node_modules/podasync/src/utility/utility.js"></script>
    <script type="text/javascript" src="../node_modules/podasync/src/network/socket.js"></script>
    <script type="text/javascript" src="../node_modules/podasync/src/network/async.js"></script>
    <script type="text/javascript" src="../node_modules/crypto-js/crypto-js.js"></script>
    <script type="text/javascript" src="../node_modules/dexie/dist/dexie.min.js"></script>
    <script type="text/javascript" src="../src/chat.js"></script>

    <!-- Production Mode -->
    <!--<script type="text/javascript" src="podchat.js"></script>-->
    <!--<script type="text/javascript" src="podchat-browser.min.js"></script>-->

    <script type="text/javascript">
        // Developement
        var PodChat = window.POD.Chat;

        // Production
        //        var PodChat = window.PodChat;


        var params = {
            appId: new Date().getTime(),

            /**
             * ActiveMQ Config
             */
            // protocol: "queue",
            // queueHost: "10.56.16.25",
            // queuePort: "61613",
            // queueUsername: "root",
            // queuePassword: "zalzalak",
            // queueReceive: "queue-in-amjadi-stomp",
            // queueSend: "queue-out-amjadi-stomp",
            // queueConnectionTimeout: 20000,
            // serverName: "chat-server",

            /**
             * ActiveMQ Config - Sheikh
             */
            // protocol: "queue",
            // queueHost: "192.168.112.23",
            // queuePort: "61613",
            // queueUsername: "root",
            // queuePassword: "j]Bm0RU8gLhbPUG",
            // queueReceive: "queue-in-local_chat",
            // queueSend: "queue-out-local_chat",
            // queueConnectionTimeout: 20000,

            // protocol: "queue",
            // queueHost: "172.16.0.248",
            // queuePort: "61613",
            // queueUsername: "root",
            // queuePassword: "zalzalak",
            // queueReceive: "queue-in-wepod",
            // queueSend: "queue-out-wepod",
            // queueConnectionTimeout: 20000,
            // serverName: "chat-server",

            /**
             * Main Server
             */
            // socketAddress: 'wss://msg.pod.ir/ws', // {**REQUIRED**} Socket Address
            // ssoHost: 'https://accounts.pod.ir', // {**REQUIRED**} Socket Address
            // platformHost: 'https://api.pod.ir/srv/core', // {**REQUIRED**} Platform Core Address
            // fileServer: 'https://core.pod.ir', // {**REQUIRED**} File Server Address
            // serverName: 'chat-server', // {**REQUIRED**} Server to to register on

            /**
             * Hamed Mehrara
             */
            // socketAddress: 'ws://172.16.106.26:8003/ws', // {**REQUIRED**} Socket Address
            // ssoHost: 'http://172.16.110.76', // {**REQUIRED**} Socket Address
            // platformHost: 'http://172.16.106.26:8080/hamsam', // {**REQUIRED**} Platform Core Address
            // fileServer: 'http://172.16.106.26:8080/hamsam', // {**REQUIRED**} File Server Address
            // serverName: 'chat-server', // {**REQUIRED**} Server to to register on

            /**
             * Mehdi Sheikh Hosseini
             */
            // socketAddress: 'ws://172.16.110.235:8003/ws', // {**REQUIRED**} Socket Address
            // ssoHost: 'http://172.16.110.76', // {**REQUIRED**} Socket Address
            // platformHost: 'http://172.16.110.76:8080', // {**REQUIRED**} Platform Core Address
            // fileServer: 'http://172.16.110.76:8080', // {**REQUIRED**} File Server Address
            // serverName: 'chat-server', // {**REQUIRED**} Server to to register on


            /**
             * Leila Nemati
             */
            // socketAddress: 'ws://172.16.110.235:8003/ws', // {**REQUIRED**} Socket Address
            // ssoHost: 'http://172.16.110.76', // {**REQUIRED**} Socket Address
            // platformHost: 'http:///172.16.110.76:8080', // {**REQUIRED**} Platform Core Address
            // fileServer: 'http:///172.16.110.76:8080', // {**REQUIRED**} File Server Address
            // serverName: 'sheikh_chat', // {**REQUIRED**} Server to to

            /**
             * Sand Box
             */
            socketAddress: "wss://chat-sandbox.pod.ir/ws", // {**REQUIRED**} Socket Address
            ssoHost: "https://accounts.pod.ir", // {**REQUIRED**} Socket Address
            platformHost: "https://sandbox.pod.ir:8043/srv/basic-platform", // {**REQUIRED**} Platform Core Address
            fileServer: "https://sandbox.pod.ir:8443", // {**REQUIRED**} File Server Address
            serverName: "chat-server", // {**REQUIRED**} Server to to register on

            grantDeviceIdFromSSO: false,
            enableCache: false, // Enable Client side caching
            fullResponseObject: false,
            mapApiKey: '8b77db18704aa646ee5aaea13e7370f4f88b9e8c',
            // typeCode: "talk",
            token: "7c9ea3fdfab94ffa9ebb3d7e0b6656b7",
            // token: "7cba09ff83554fc98726430c30afcfc6", // {**REQUIRED**} SSO Token ZiZi
            // token: "fbd4ecedb898426394646e65c6b1d5d1", //  {**REQUIRED**} SSO Token JiJi
            // token: "5fb88da4c6914d07a501a76d68a62363", // {**REQUIRED**} SSO Token FiFi
            // token: "bebc31c4ead6458c90b607496dae25c6", // {**REQUIRED**} SSO Token Alexi
            // token: "e4f1d5da7b254d9381d0487387eabb0a", // {**REQUIRED**} SSO Token Felfeli
            wsConnectionWaitTime: 500, // Time out to wait for socket to get ready after open
            connectionRetryInterval: 5000, // Time interval to retry registering device or registering server
            connectionCheckTimeout: 10000, // Socket connection live time on server
            messageTtl: 24 * 60 * 60, // Message time to live (1 day in seonds)
            reconnectOnClose: true, // auto connect to socket after socket close
            httpRequestTimeout: 30000,
            httpUploadRequestTimeout: 0, // 0 means No timeout
            asyncLogging: {
                onFunction: true, // log main actions on console
                // onMessageReceive: true, // log received messages on console
                // onMessageSend: true, // log sent messaged on console
                // actualTiming: true // log actual functions running time
            }
        };

        var chatAgent = new PodChat(params),
            PID,
            P2P_THREAD_ID = 293;

        chatAgent.on("chatReady", function () {

            /*******************************************************
             *                       U S E R                       *
             *******************************************************/

            /**
             *  Get User Info
             */
            // getUserInfo();

            /*******************************************************
             *                    T H R E A D S                    *
             *******************************************************/

            /**
             * GET THREADS
             * @param count
             * @param offset
             * @param threadIds
             * @param name
             */
            // getThreads({
            //   count: 5,
            //   offset: 0,
            //   // threadIds: [312, 1210],
            //   // name: "flower"
            // });

            /**
             * CREATE THREAD (Creates Group)
             * @param invitees
             * @param threadType
             */
            // createThread([{
            //   id: 581,
            //   type: "TO_BE_USER_CONTACT_ID"
            // }, {
            //   id: 582,
            //   type: "TO_BE_USER_CONTACT_ID"
            // }], "NORMAL");

            /**
             * CREATE THREAD (Creates P2P Chat with a specific user)
             * @param contactId
             */
            // createThread({id: 121, type: "TO_BE_USER_ID"});

            /**
             * GET THREAD PARTICIPANTS
             * @param threadId
             */
            // getThreadParticipants(293);

            /**
             * ADD PARTICIPANTS
             * @param threadId
             * @param contacts {Array}  CONTACT ID
             */
            // addParticipants(3, [583]);

            /**
             * REMOVE PARTICIPANTS
             * @param threadId
             * @param participants {Array}  USER ID
             */
            // removeParticipants(3, [4]);

            /**
             * LEAVE THREAD
             * @param threadId
             */
            // leaveThread(3);

            /**
             * GET THREAD HISTORY
             * @param count
             * @param offset
             * @param threadId
             * @param firstMessageId
             * @param lastMessageId
             * @param metaQuery
             * @param query
             */
            //             getHistory({
            //               count: 10,
            //               offset: 0,
            //               threadId: 312,
            //               // firstMessageId: 17035,
            //               // order: "ASC",
            //               // lastMessageId: 17052,
            //               // metadataCriteria: {
            //               //   "field": "type",
            //               //   "has": "BOT_",
            //               //   "and": [{
            //               //     "field": "id",
            //               //     "is": "1534835339446"
            //               //   }]
            //               // },
            ////               query: "query"
            //             });

            /**
             * GET SINGLE MESSAGE
             * @param threadId
             * @param messageId
             */
            // getSingleMessage(293, 13698);

            /**
             * MUTE THREAD
             * @param threadId
             */
            // muteThread(3);

            /**
             * UNMUTE THREAD
             * @param threadId
             */
            // unMuteThread(3);

            /**
             * UPDATE THREAD INFO
             * @param threadId
             */
            // chatAgent.updateThreadInfo({
            //   threadId: 1152,
            //   image: "https://static2.farakav.com/files/pictures/thumb/01330672.jpg",
            //   description: "توضیحات ترد",
            //   title: "عنوان ترد",
            //   metadata: {
            //     id: 1152,
            //     owner: "masoudmanson",
            //     name: "John Doe"
            //   }
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * SPAM P2P THREAD
             * @param threadId
             */
            // chatAgent.spamPvThread({
            //   threadId: 1020
            // }, function(result) {
            //   console.log(result);
            // });

            /*******************************************************
             *                   C O N T A C T S                   *
             *******************************************************/

            /**
             * GET CONTACTS
             */
            // getContacts();

            /**
             * BLOCK CONTACT
             * @param contactId
             */
            // blockContact(563);

            /**
             * GET BLOCKED CONTACTS LIST
             * @param count
             * @param offset
             */
            // getBlockedList();

            /**
             * UNBLOCK CONTACT
             * @param blockId
             */
            // unblockContact(83);

            /**
             * ADD CONTACTS
             * @param firstName
             * @param lastName
             * @param cellphoneNumber
             * @param email
             */
            // var addContactInstantResult = chatAgent.addContacts({
            //   firstName: "حامد",
            //   lastName: "مهرآرا",
            //   cellphoneNumber: "09188644304",
            //   email: "hamed.m844a@gmail.com"
            // }, function(result) {
            //   console.log(result);
            // });
            /**
             * UPDATE CONTACTS
             * @param id
             * @param firstName
             * @param lastName
             * @param cellphoneNumber
             * @param email
             */
            // chatAgent.updateContacts({
            //   id: "563",
            //     firstName: "Fifi",
            //     lastName: "Fifuli",
            //     cellphoneNumber: "09122964316",
            //     email: "fifuli@fanap.ir"
            // }, function(result) {
            //   console.log(result.result);
            // });

            /**
             * REMOVE CONTACTS
             * @param id
             */
            // chatAgent.removeContacts({
            //   id: "1103"
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * SEARCH CONTACTS
             * @link http://sandbox.pod.land:8080/apidocs/swagger-ui.html?srv=/nzh/listContacts
             */
            // chatAgent.searchContacts({
            //   // cellphoneNumber: "0912", // LIKE
            //   // id: 563, // EXACT
            //   // firstName: "masodi", // LIKE
            //   // lastName: "ra", // LIKE
            //   // email: "m", // LIKE
            //   // uniqueId: "f10c94f7-3013-4e34-9b3e-6a3bd25ce2a6", // EXACT
            //   q: "v" // LIKE in firstName, lastName, email
            // }, function(result) {
            //   if (!result.hasError) {
            //     console.log(result);
            //   }
            // });

            /*******************************************************
             *                   M E S S A G E S                   *
             *******************************************************/

            /**
             * SEND MESSAGE IN THREAD
             * @param threadId
             * @param newMessage
             * @param metadata
             */
            // sendMessage(15, "PooPoo This is a Sample Message at " + new Date(), {
            //   id: new Date().getTime(),
            //   type: "BOT_MESSAGE",
            //   owner: "Masoud"
            // });

            /**
             * SEND FILE MESSAGE IN THREAD
             * @param threadId
             * @param file
             * @param caption
             * @param metadata
             */
            // sendFileMessage(15, __dirname + "/test/image.jpg", "Sample file description", {
            //   custom_name: "John Doe"
            // });

            /**
             * SEND BOT MESSAGE IN THREAD
             * @param messageId
             * @param receiverId
             * @param newMessage
             */
            // sendBotMessage(14954, 121, {
            //   command: "reverse",
            //   lat: "35.7003510",
            //   lng: "51.3376472"
            // });

            /**
             * EDIT MESSAGE IN THREAD
             * @param messageId  325 editable: false
             * @param newMessage
             */
            // editMessage(1, "This message has been edited at " + new Date());

            /**
             * DELETE MESSAGE IN THREAD
             * @param {int}      messageId
             * @param {boolean}  deleteForAll
             */
            // deleteMessage(15672, true);

            /**
             * REPLY TO MESSAGE
             * @param threadId
             * @param messageId
             */
            // replyMessage(1, 1, "This is a reply to message #1 at " + new Date());

            /**
             * FORWARD MESSAGE
             * @param destination
             * @param messageIds
             */
            // forwardMessage(1431, [17259, 17258]);

            /**
             * GET MESSAGE SEEN LIST
             * @param messageId
             */
            // chatAgent.getMessageSeenList({
            //   messageId: 19623
            // }, function(seenList) {
            //   console.log("Seen list", seenList);
            // });

            /**
             * GET MESSAGE DELIVERED LIST
             * @param messageId
             */
            // chatAgent.getMessageDeliveredList({
            //   messageId: 19623
            // }, function(seenList) {
            //   console.log("Delivery list", seenList);
            // });

            /*******************************************************
             *               F I L E   U P L O A D S               *
             *******************************************************/

            /**
             * UPLOAD IMAGE
             * @param  {string}  image     Image path
             * @param  {int}     xC        Crop start x coordinates
             * @param  {int}     yC        Crop start y coordinates
             * @param  {int}     hC        Crop height
             * @param  {int}     wC        Crop width
             */
            // uploadImage(__dirname + "/test/test.jpeg", 0, 0, 400, 400);

            /**
             * GET IMAGE
             * @param  {int}     imageId     Image ID
             * @param  {string}  hashCode    Hash Code
             */
            // getImage(2531, '1649d4e932a-0.8852815409984853');

            /**
             * UPLOAD FILE
             * @param  {string}  file     File path
             */
            // uploadFile(__dirname + "/test/test.txt");

            /**
             * GET FILE
             * @param  {int}     fileId          Image ID
             * @param  {string}  hashCode        Hash Code
             * @param  {boolean} downloadable    Downloadable link or not?
             */
            // getFile(344, '196CHI61NUROW8S1', true);

            /*******************************************************
             *                 N E S H A N   M A P                 *
             *******************************************************/

            /**
             * Get Address of a GeoLocation point
             *
             * @param  {float}   lat     Latitute of the Location
             * @param  {float}   lng     Longtitute of the Location
             */
            // chatAgent.mapReverse({
            //   lat: 35.7003508,
            //   lng: 51.3376460
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * Get nearby places names as "term" keyword
             * around the given GeoLocation
             *
             * @param  {float}   lat     Latitute of the Location
             * @param  {float}   lng     Longtitute of the Location
             * @param  {string}  term    Search term to be searched
             */
            // chatAgent.mapSearch({
            //   lat: 35.7003508,
            //   lng: 51.3376460,
            //   term: "فروشگاه"
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * Get routing between two given GeoLocations
             *
             * @param  {object}   origin         Lat & Lng of Origin as a JSON
             * @param  {object}   destination    Lat & Lng of Destination as a JSON
             * @param  {boolean}  alternative    Give Alternative Routs too
             */
            // chatAgent.mapRouting({
            //   origin: {
            //     lat: 35.7003508,
            //     lng: 51.3376460
            //   },
            //   destination: {
            //     lat: 35.7343510,
            //     lng: 50.3376472
            //   },
            //   alternative: true
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * Get Static Image of a GeoLocation
             *
             * @param  {string}   type           Map style (default standard-night)
             * @param  {int}      zoom           Map zoom (default 15)
             * @param  {object}   center         Lat & Lng of Map center as a JSON
             * @param  {int}      width          width of image in pixels (default 800px)
             * @param  {int}      height         height of image in pixels (default 600px)
             */
            // chatAgent.mapStaticImage({
            //   type: "standard-night",
            //   zoom: 15,
            //   center: {
            //     lat: 35.7003508,
            //     lng: 51.3376462
            //   },
            //   width: 800,
            //   height: 500
            // }, function(result) {
            //   console.log(result);
            // });
        });

        /**
         * Listen to Error Messages
         */
        chatAgent.on("error", function (error) {
            console.log("Error ", error);
            // console.log("Error ", error.error);
        });

        /**
         * Listen to Chat State Changes
         */
        chatAgent.on("chatState", function (chatState) {
        });

        /**
         * Listen to File Upload Events
         */
        chatAgent.on("fileUploadEvents", function (event) {
            var type = event.type;
            console.log(event);
        });

        chatAgent.on("contactEvents", function (event) {
            console.log(event);
        });

        /**
         * Listen to Thread Events
         */
        chatAgent.on("threadEvents", function (event) {
            var type = event.type;
            console.log(event);

            switch (type) {
                case "THREAD_LAST_ACTIVITY_TIME":
                    break;

                case "THREAD_NEW":

                    break;

                case "THREAD_ADD_PARTICIPANTS":
                    break;

                case "THREAD_REMOVE_PARTICIPANTS":
                    break;

                case "THREAD_LEAVE_PARTICIPANT":
                    break;

                case "THREAD_REMOVED_FROM":
                    break;

                case "THREAD_RENAME":
                    break;

                case "THREAD_MUTE":
                    break;

                case "THREAD_UNMUTE":
                    break;

                case "THREAD_INFO_UPDATED":
                    break;

                case "THREAD_UNREAD_COUNT_UPDATED":
                    break;

                default:
                    break;
            }
        });

        /**
         * Listen to Message Events
         */
        chatAgent.on("messageEvents", function (event) {
            var type = event.type,
                message = event.result.message;

            console.log(event);

            switch (type) {
                case "MESSAGE_NEW":
                    /**
                     * Sending Message Seen to Sender after 5 secs
                     */
                    setTimeout(function () {
                        chatAgent.seen({
                            messageId: message.id,
                            ownerId: message.ownerId
                        });
                    }, 5000);

                    break;

                case "MESSAGE_EDIT":
                    break;

                case "MESSAGE_DELIVERY":
                    break;

                case "MESSAGE_SEEN":
                    break;

                default:
                    break;
            }
        });

        /**
         * Listen to System Events
         */
        chatAgent.on("systemEvents", function (event) {
            var type = event.type;
            console.log(event);

            switch (type) {
                case "IS_TYPING":
                    console.log(event.result.user.user + " is typing in thread #" + event.result.thread);
                    break;

                default:
                    break;
            }
        });

        /**
         * Local Functions
         */

        function getUserInfo() {
            chatAgent.getUserInfo(function (userInfo) {
                console.log(userInfo);
            });
        }

        function getThreads(params) {
            var instantResult = chatAgent.getThreads(params, function (threadsResult) {
                if (!threadsResult.hasError) {
                    var threadsCount = threadsResult.result.contentCount;
                    var threads = threadsResult.result.threads;
                    console.log(threadsResult);
                }
            });
            // console.log(instantResult);
        }

        function getThreadParticipants(threadId) {
            var getParticipantsParams = {
                count: 50,
                offset: 0,
                threadId: threadId,
                // name: "مهیار"
            };

            chatAgent.getThreadParticipants(getParticipantsParams, function (participantsResult) {
                if (!participantsResult.hasError) {
                    console.log(participantsResult);
                }
            });
        }

        function addParticipants(threadId, contacts) {
            chatAgent.addParticipants({
                threadId: threadId,
                contacts: contacts
            }, function (result) {
                console.log(result);
            });

        }

        function removeParticipants(threadId, participants) {
            chatAgent.removeParticipants({
                threadId: threadId,
                participants: participants
            }, function (result) {
                // console.log(result);
            });

        }

        function leaveThread(threadId) {
            chatAgent.leaveThread({
                threadId: threadId
            }, function (result) {
                // console.log(result);
            });
        }

        function getContacts(params) {
            var getContactsParams = {
                count: 5,
                offset: 0
            };

            if (params) {
                if (typeof params.name === "string") {
                    getContactsParams.name = params.name;
                }
            }
            chatAgent.getContacts(params, function (contactsResult) {
                if (!contactsResult.hasError) {
                    console.log(contactsResult);
                }
            });
        }

        function getSingleMessage(threadId, messageId) {
            chatAgent.getHistory({
                offset: 0,
                threadId: threadId,
                id: messageId
            }, function (historyResult) {
                if (!historyResult.hasError) {
                    console.log(historyResult.result.history);
                }
            });
        }

        function getHistory(params) {
            var test = chatAgent.getHistory(params, function (historyResult) {
                if (!historyResult.hasError) {
                    console.log(historyResult);

                    //                    for(var i=0; i<historyResult.result.history.length; i++) {
                    //                        console.log(historyResult.result.history[i].id, historyResult.result.history[i].systemMetadata);
                    //                    }
                }
            });
            // console.log(test);
        }

        function sendMessage(threadId, message, metadata) {
            sendChatParams = {
                threadId: threadId,
                content: message,
                systemMetadata: metadata
            };

            var sentMesageUniqueId = chatAgent.sendTextMessage(sendChatParams, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen!");
                }
            });

            console.log(sentMesageUniqueId);
        }

        function sendFileMessage(threadId, file, caption, metadata) {
            var instantResult = chatAgent.sendFileMessage({
                threadId: threadId,
                file: file,
                content: caption,
                systemMetadata: metadata
            }, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen!");
                }
            });

            console.log("Some test");
            console.log("\nInstant Result For sendFileMessage:\n", instantResult);
        }

        function sendBotMessage(messageId, receiverId, message, metadata) {
            sendChatParams = {
                messageId: messageId,
                content: message,
                receiver: receiverId,
                systemMetadata: metadata
            };

            var mim = chatAgent.sendBotMessage(sendChatParams, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                }
            });

            console.log(mim);
        }

        function editMessage(messageId, newMessage) {
            editChatParams = {
                messageId: messageId,
                content: newMessage
            };

            chatAgent.editMessage(editChatParams, function (result) {
                console.log(result);
            });
        }

        function deleteMessage(messageId, deleteForAll) {
            if (typeof deleteForAll == "undefined") {
                deleteForAll = false;
            }

            chatAgent.deleteMessage({
                messageId: messageId,
                deleteForAll: deleteForAll
            }, function (result) {
                console.log(result);
            });
        }

        function replyMessage(threadId, messageId, message) {
            replyChatParams = {
                threadId: threadId,
                repliedTo: messageId,
                content: message
            };

            chatAgent.replyMessage(replyChatParams, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent! (Reply)");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered! (Reply)");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen! (Reply)");
                }
            });
        }

        function forwardMessage(destination, messageIds) {
            chatAgent.forwardMessage({
                subjectId: destination,
                content: JSON.stringify(messageIds)
            }, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent! (FORWARD)");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered! (FORWARD)");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen! (FORWARD)");
                }
            });
        }

        function createThread(invitees, threadType) {
            if (typeof threadType == "string") {
                threadTypeText = threadType;
            }
            else {
                threadTypeText = "NORMAL";
            }

            createThreadParams = {
                title: "Thread Title Sample",
                type: threadTypeText,
                invitees: []
            };

            if (Array.isArray(invitees)) {
                for (var i = 0; i < invitees.length; i++) {
                    invitee = formatDataToMakeInvitee({
                        id: invitees[i].id,
                        type: invitees[i].type
                    });
                    if (invitee) {
                        createThreadParams.invitees.push(invitee);
                    }
                }
            }
            else {
                invitee = formatDataToMakeInvitee({
                    id: invitees.id,
                    type: invitees.type
                });
                if (invitee) {
                    createThreadParams.invitees.push(invitee);
                }
            }

            chatAgent.createThread(createThreadParams, function (createThreadResult) {
                console.log(createThreadResult);
            });
        }

        function renameThread(threadId, newName) {
            renameThreadParams = {
                title: newName,
                threadId: threadId
            };

            chatAgent.renameThread(renameThreadParams, function (renameThreadResult) {
                console.log(renameThreadResult);
            });
        }

        function muteThread(threadId) {
            var data = {
                subjectId: threadId
            }
            chatAgent.muteThread(data, function (result) {
                if (!result.hasError) {
                    console.log("Threaded has been successfully muted!");
                }
                console.log(result);
            });
        }

        function blockContact(contactId) {
            var data = {
                contactId: contactId
            }
            chatAgent.block(data, function (result) {
                if (!result.hasError) {
                    console.log("Contact has been successfully Blocked!");
                }
                console.log(result);
            });
        }

        function unblockContact(blockId) {
            var data = {
                blockId: blockId
            }
            chatAgent.unblock(data, function (result) {
                if (!result.hasError) {
                    console.log("Contact has been successfully unBlocked!");
                }
                console.log(result);
            });
        }

        function getBlockedList() {
            var data = {
                count: 50,
                offset: 0
            }
            chatAgent.getBlocked(data, function (result) {
                if (!result.hasError) {
                    console.log(result);
                }
            });
        }

        function unMuteThread(threadId) {
            var data = {
                subjectId: threadId
            }
            chatAgent.unMuteThread(data, function (result) {
                if (!result.hasError)
                    console.log("Threaded has been successfully unMuted!");
                console.log(result);
            });
        }

        function formatDataToMakeInvitee(messageContent) {
            var inviteeData = {
                id: messageContent.id,
                idType: messageContent.type
            };

            return inviteeData;
        }

        function uploadImage(image, xC, yC, hC, wC) {
            chatAgent.uploadImage({
                image: image,
                xC: xC,
                yC: yC,
                hC: hC,
                wC: wC
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    var image = result.result;
                    console.log("Image has been Successfully Uploaded => \n\n", image);
                }
            });
        }

        function getImage(imageId, hashCode) {
            chatAgent.getImage({
                imageId: imageId,
                hashCode: hashCode
            }, function (result) {
                if (!result.hasError) {
                    console.log("Image has been successfully received => \n", result.result);
                }
            });
        }

        function uploadFile(file) {
            chatAgent.uploadFile({
                file: file
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    var file = result.result;
                    console.log("File has been Successfully Uploaded => \n", file);
                }
            });
        }

        function getFile(fileId, hashCode, downloadable) {
            chatAgent.getFile({
                fileId: fileId,
                hashCode: hashCode,
                downloadable: downloadable
            }, function (result) {
                if (!result.hasError) {
                    console.log("File has been successfully received => \n", result.result);
                }
            });
        }

        function removeContacts(id) {
            chatAgent.removeContacts({
                id: id
            }, function (result) {
                console.log(result);
            });
        }
    </script>

    <style>
        .btn {
            padding: 10px 25px;
            color: #fff;
            background-color: #222;
            border: none !important;
            text-decoration: none;
            margin: 10px 15px;
            display: inline-block;
        }

        #reconnect,
        #clearCache,
        #deleteCache {
            display: inline-block;
            font-size: 12px;
            color: #aaa;
            margin-left: 10px;
            cursor: pointer;
        }
    </style>
</head>

<body style="max-width: 600px;">
<p>POD CHAT <span id="reconnect">Reconnect...</span> | <span id="clearCache">Clear User Cache</span> | <span
        id="deleteCache">Delete Cache</span></p>

<form>
    <fieldset>
        <legend>General Functionalities</legend>
        <label for="g-p2p">P2P Thread Id : </label>
        <input type="text" name="p2p" id="g-p2p" value="312">
        <label for="g-p2p-off">offset: </label>
        <input type="text" name="p2poff" id="g-p2p-off" value="0" size="2">
        <label for="g-p2p-count">Count: </label>
        <input type="text" name="p2pcount" id="g-p2p-count" value="10" size="2">
        <br>
        <a class="btn" href="#" onclick="getContacts({
            count:document.getElementById('g-p2p-count').value,
            offset: document.getElementById('g-p2p-off').value
        })">Get Contacts</a>
        <a class="btn" href="#" onclick="getThreads({count:50, offset: 0})">Get Threads</a>
        <a class="btn" href="#" onclick="getHistory({
//            fromTimeFull: 1557830885624256000,
//            toTimeFull: 1558247572310448000,
            count:document.getElementById('g-p2p-count').value,
            offset: document.getElementById('g-p2p-off').value,
            threadId: document.getElementById('g-p2p').value});">Get History</a>
        <a class="btn" href="#" onclick="getThreadParticipants(document.getElementById('g-p2p').value)">Get Thread
            Participants</a>
        <a class="btn" href="#" onclick="chatAgent.getThreadAdmins({threadId:document.getElementById('g-p2p').value}, function(res){
            console.log(res);
        })">Get Thread Admins</a>
        <a class="btn" href="#" onclick="leaveThread(document.getElementById('g-p2p').value)">Leave Thread</a>
        <br>
        <br>
    </fieldset>
</form>


<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Create Thread</legend>
        <label for="createThreadTitle">Thread title</label>
        <input type="text" name="createThreadTitle" id="createThreadTitle" value="Thread Title">

        <label for="createThreadType">Thread Type</label>
        <select name="createThreadType" id="createThreadType">
            <option value="NORMAL">NORMAL</option>
            <option value="OWNER_GROUP">OWNER_GROUP</option>
            <option value="PUBLIC_GROUP">PUBLIC_GROUP</option>
            <option value="CHANNEL_GROUP">CHANNEL_GROUP</option>
            <option value="CHANNEL">CHANNEL</option>
        </select>
        <br>


        <label for="createThreadImage">Thread img</label>
        <input type="text" name="createThreadImage" id="createThreadImage" value="">

        <label for="createThreadDesc">Thread Desc</label>
        <input type="text" name="createThreadDesc" id="createThreadDesc" value="Thread Description">

        <br>

        <label for="createThreadMetadata">Thread Metadata (JSON)</label>
        <textarea name="createThreadMetadata" id="createThreadMetadata" rows="4" cols="70"></textarea>

        <br>

        <label for="createThreadInvitees">Thread Invitees (JSON Array)</label>
        <textarea name="createThreadInvitees" id="createThreadInvitees" rows="10" cols="70">
[{
  "id": 122,
  "type": "TO_BE_USER_CONTACT_ID"
}, {
  "id": 1102,
  "type": "TO_BE_USER_CONTACT_ID"
}]
      </textarea>

        <button type="button" name="button" id="createThreadButton">Create Thread</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Add Participant to Thread</legend>
        <label for="apThread">Thread Id</label>
        <input type="text" name="apThread" id="apThread">
        <br>
        <label for="apList">Participants (Array of IDs):</label>
        <input type="text" name="apList" id="apList" placeholder="1, 2, 3, ...">
        <button type="button" name="button" id="apButton">Add Participants</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Send Text Message</legend>
        <label for="sendTextThread">Thread Id</label>
        <input type="text" name="sendTextThread" id="sendTextThread">
        <br>
        <label for="sendTextMessage">Message :</label>
        <textarea type="text" name="sendTextMessage" id="sendTextMessage"></textarea>
        <button type="button" name="button" id="sendTextButton">Send Text Message</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Resend Message by UniqueId</legend>
        <label for="resendUid">Unique Id</label>
        <input type="text" name="resendUid" id="resendUid">
        <br>
        <button type="button" name="button" id="resendButton">Resend Message</button>
        <button type="button" name="button" id="cancelButton">Cancel Message</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Send File Message</legend>
        <label for="sendFileThread">Thread Id</label>
        <input type="text" name="sendFileThread" id="sendFileThread">
        <br>
        <input type="file" name="sendFileInput" id="sendFileInput">
        <br>
        <label for="sendFileDescription">Description: </label>
        <textarea type="text" name="sendFileDescription" id="sendFileDescription"></textarea>
        <button type="button" name="button" id="sendFileMessage">Send File Message</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Upload Image</legend>
        <input type="file" name="image" id="imageInput" value="">
        <button type="button" name="button" id="uploadImage">Upload Image</button>
        <br>
        <img id="uploadedImage"/>
        <div id="uploadedImageData"></div>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Upload File</legend>
        <input type="file" name="file" id="fileInput" value="">
        <button type="button" name="button" id="uploadFile">Upload File</button>
        <br>
        <div id="uploadedFile"></div>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Get Image</legend>
        <label for="imageId">Image ID : </label>
        <input type="text" name="imageId" id="imageId" value="">
        <br>
        <label for="hashCode">HashCode:</label>
        <input type="text" name="hashCode" id="hashCode" value="">
        <button type="button" name="button" id="getImage">Get Image</button>
        <br>
        <img id="getImageResult"/>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Get File</legend>
        <label for="fileId">File ID : </label>
        <input type="text" name="fileId" id="fileId" value="">
        <br>
        <label for="fileHashCode">HashCode:</label>
        <input type="text" name="fileHashCode" id="fileHashCode" value="">
        <button type="button" name="button" id="getFile">Get File</button>
        <br>
        <div id="getFileResult"></div>
    </fieldset>
</form>


<br>
<hr>
<br>

<form method="POST" action="http://172.16.110.131:8080/nzh/addContacts">
    <fieldset>
        <legend>Add Contact</legend>
        <label for="firstName">firstName : </label>
        <input type="text" name="firstName" id="firstName" value="">
        <br>
        <label for="lastName">lastName : </label>
        <input type="text" name="lastName" id="lastName" value="">
        <br>
        <label for="cellphoneNumber">cellphoneNumber : </label>
        <input type="text" name="cellphoneNumber" id="cellphoneNumber" value="">
        <br>
        <label for="email">email : </label>
        <input type="text" name="email" id="email" value="">
        <br>
        <label for="_token_">Token : </label>
        <input type="text" name="_token_">
        <br>
        <label for="uniqueId">uniqueId : </label>
        <input type="text" name="uniqueId">
        <br>

        <input type="hidden" name="_token_issuer_" value="1">
        <button type="submit">Add Contact</button>
    </fieldset>
</form>


<br>
<hr>
<br>

<form method="post" action="poll.pollcode.com/33712898">
    <div style="padding:2px;width:325px;font-size:small;color:#000000;">
        <div style="padding:2px 0px 4px 2px;"><strong>کدام ویژگی را بیشتر نیاز دارید؟</strong></div>
        <hr/>
        <input type="radio" name="answer" value="1" id="answer337128981" style="float:left;"/><label
            for="answer337128981" style="float:left;width:300px;">صفحه بندی مخاطب ها</label>
        <div style="clear:both;height:2px;"></div>
        <input type="radio" name="answer" value="2" id="answer337128982" style="float:left;"/><label
            for="answer337128982" style="float:left;width:300px;">امکان حذف گفتگو</label>
        <div style="clear:both;height:2px;"></div>
        <input type="radio" name="answer" value="3" id="answer337128983" style="float:left;"/><label
            for="answer337128983" style="float:left;width:300px;">امکان منشن اعضا</label>
        <div style="clear:both;height:2px;"></div>
        <input type="radio" name="answer" value="4" id="answer337128984" style="float:left;"/><label
            for="answer337128984" style="float:left;width:300px;">امکان جستجو در لیست اعضا</label>
        <div style="clear:both;height:2px;"></div>
        <br/>
        <div align="center" style="padding:3px;"><input type="submit" value=" Vote ">&nbsp;<input type="submit"
                                                                                                  name="view"
                                                                                                  value=" View "></div>
    </div>
</form>

<form method="POST" action="http://172.16.110.131:8080/nzh/updateContacts">
    <fieldset>
        <legend>Update Contact</legend>
        <label for="id">id : </label>
        <input type="text" name="id" id="id" value="">
        <br>
        <label for="firstName">firstName : </label>
        <input type="text" name="firstName" id="firstName" value="">
        <br>
        <label for="lastName">lastName : </label>
        <input type="text" name="lastName" id="lastName" value="">
        <br>
        <label for="cellphoneNumber">cellphoneNumber : </label>
        <input type="text" name="cellphoneNumber" id="cellphoneNumber" value="">
        <br>
        <label for="email">email : </label>
        <input type="text" name="email" id="email" value="">
        <br>
        <label for="_token_">Token : </label>
        <input type="text" name="_token_">
        <br>
        <label for="uniqueId">uniqueId : </label>
        <input type="text" name="uniqueId">
        <br>

        <input type="hidden" name="_token_issuer_" value="1">
        <button type="submit">Update Contact</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form action="">
    <fieldset>
        <legend>Remove Contact</legend>
        <label for="contact_id">id : </label>
        <input type="text" name="contact_id" id="contact_id" value="">
        <br>
        <label for="_token_">Token : </label>
        <input type="text" name="_token_">
        <br>
        <input type="hidden" name="_token_issuer_" value="1">
        <button type="button" onclick="removeContacts(document.getElementById('contact_id').value)">Remove Contact
        </button>
    </fieldset>
</form>

</body>

<script>
    document.getElementById("reconnect")
        .addEventListener("click", function () {
            chatAgent.reconnect();
        });

    document.getElementById("clearCache")
        .addEventListener("click", function () {
            chatAgent.clearCacheDatabasesOfUser();
        });

    document.getElementById("deleteCache")
        .addEventListener("click", function () {
            chatAgent.deleteCacheDatabases({storage: true, queues: true});
        });

    /**
     * CREATE THREAD
     */
    document.getElementById("createThreadButton")
        .addEventListener("click", function () {
            var invitees = JSON.parse(document.getElementById("createThreadInvitees").value);

            createThreadParams = {
                title: document.getElementById("createThreadTitle").value,
                type: document.getElementById("createThreadType").value,
                invitees: [],
                image: document.getElementById("createThreadImage").value,
                description: document.getElementById("createThreadDesc").value,
                metadata: document.getElementById("createThreadMetadata").value
            };

            if (Array.isArray(invitees)) {
                for (var i = 0; i < invitees.length; i++) {
                    invitee = formatDataToMakeInvitee({
                        id: invitees[i].id,
                        type: invitees[i].type
                    });
                    if (invitee) {
                        createThreadParams.invitees.push(invitee);
                    }
                }
            }
            else {
                invitee = formatDataToMakeInvitee({
                    id: invitees.id,
                    type: invitees.type
                });
                if (invitee) {
                    createThreadParams.invitees.push(invitee);
                }
            }

            chatAgent.createThread(createThreadParams, function (createThreadResult) {
                console.log(createThreadResult);
            });
        });

    /**
     * SEND FILE
     */
    document.getElementById("sendTextButton")
        .addEventListener("click", function () {
            var message = document.getElementById("sendTextMessage").value,
                thread = document.getElementById("sendTextThread").value;

            var instantResult = chatAgent.sendTextMessage({
                threadId: thread,
                content: message
            }, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen!");
                }
            });
        });

    /**
     * ADD PARTICIPANTS
     */
    document.getElementById("apButton")
        .addEventListener("click", function () {
            var participants = document.getElementById("apList")
                    .value
                    .split(","),
                thread = document.getElementById("apThread").value;

            chatAgent.addParticipants({
                threadId: thread,
                contacts: participants
            }, function (result) {
                console.log(result);
            });
        });

    /**
     * Resend Message
     */
    document.getElementById("resendButton")
        .addEventListener("click", function () {
            var uniqueId = document.getElementById("resendUid").value;

            chatAgent.resendMessage(uniqueId);
        });

    /**
     * Cancel Message
     */
    document.getElementById("cancelButton")
        .addEventListener("click", function () {
            var uniqueId = document.getElementById("resendUid").value;

            chatAgent.cancelMessage(uniqueId, function () {
                console.log("Message has been canceled");
            });
        });

    /**
     * SEND FILE
     */
    document.getElementById("sendFileMessage")
        .addEventListener("click", function () {
            var fileInput = document.getElementById("sendFileInput"),
                image = fileInput.files[0],
                content = document.getElementById("sendFileDescription").value,
                thread = document.getElementById("sendFileThread").value;

            var instantResult = chatAgent.sendFileMessage({
                threadId: thread,
                file: image,
                content: content,
                metadata: {
                    custom_name: "John Doe"
                }
            }, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen!");
                }
            });

            console.log("Instant sendFile Results", instantResult)

            // console.log("Should cancel file upload after 100ms. (uid = " + instantResult.content.file.uniqueId + ")")
            // setTimeout(() => {
            //   chatAgent.cancelFileUpload({
            //     uniqueId: instantResult.content.file.uniqueId
            //   }, function() {
            //     console.log("Upload has been Canceled!");
            //   });
            // }, 100);
        });

    /**
     * UPLOAD IMAGE
     */
    document.getElementById("uploadImage")
        .addEventListener("click", function () {
            var imageInput = document.getElementById("imageInput"),
                image = imageInput.files[0];

            var uploadResult = chatAgent.uploadImage({
                image: image,
                // fileName: "Test Name",
                xC: 100,
                yC: 100,
                hC: 800,
                wC: 800
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    var image = result.result;

                    chatAgent.getImage({
                        imageId: image.id,
                        hashCode: image.hashCode
                    }, function (result) {
                        if (!result.hasError) {
                            document.getElementById("uploadedImage").src = result.result;
                            document.getElementById("uploadedImageData").innerHTML = "<pre><br>Uploaded Image Id: " +
                                image.id + "<br>Uploaded Image Name : " + image.name +
                                "<br>Uploaded Image HashCode : " +
                                image.hashCode + "</pre>";
                        }
                    });
                }
            });

            console.log(uploadResult);
        });

    /**
     * UPLOAD FILE
     */
    document.getElementById("uploadFile")
        .addEventListener("click", function () {
            var fileInput = document.getElementById("fileInput"),
                file = fileInput.files[0];

            var uploadResult = chatAgent.uploadFile({
                file: file,
                // fileName: "Test Name"
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    var file = result.result;
                    document.getElementById("uploadedFile").innerHTML = "<pre><br>Uploaded File Id: " + file.id +
                        "<br>Uploaded File Name : " + file.name + "<br>Uploaded File HashCode : " + file.hashCode +
                        "</pre>";
                }
            });

            console.log(uploadResult);
        });

    /**
     * GET IMAGE
     */
    document.getElementById("getImage")
        .addEventListener("click", function () {
            var imageId = document.getElementById("imageId").value,
                hashCode = document.getElementById("hashCode").value;

            chatAgent.getImage({
                imageId: imageId,
                hashCode: hashCode
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    document.getElementById("getImageResult").src = result.result;
                }
            });
        });

    /**
     * GET FILE
     */
    document.getElementById("getFile")
        .addEventListener("click", function () {
            var fileId = document.getElementById("fileId").value,
                hashCode = document.getElementById("fileHashCode").value;

            chatAgent.getFile({
                fileId: fileId,
                hashCode: hashCode,
                downloadable: true
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    document.getElementById("getFileResult").innerHTML = "<a href=\"" + result.result + "\">" +
                        result.result + "</a>";
                }
            });
        });
</script>

</html>
